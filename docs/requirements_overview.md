# macOS 截图程序 - 需求概要

## 项目背景
开发一款针对新版 macOS 的截图工具，旨在利用原生技术栈（Swift + macOS SDK）提供流畅、高效的截图体验。

## 核心功能模块

### 1. 核心截图模块 (Capture Engine)
*   **功能目标**：负责屏幕画面的精确捕获。
*   **关键特性**：
    *   **区域选择**：支持鼠标拖拽选择截图区域。
    *   **全屏截图**：一键捕获当前屏幕完整内容。
    *   **窗口截图**：智能识别鼠标下的应用窗口并自动吸附/高亮。
    *   **多屏支持**：完美支持多显示器环境。
    *   **长截图**：支持滚动截取长页面（如网页、聊天记录）。
    *   **Pin 图（贴图）**：支持将截图“钉”在屏幕最顶层，作为临时参考，可调整透明度和大小。

### 2. 标注与编辑模块 (Annotation & Editor)
*   **功能目标**：提供灵活的编辑能力，支持**截图前预标注**和**截图后编辑**。
*   **关键特性**：
    *   **预标注**：在选定区域前或过程中，即可在屏幕上进行绘制（类似电子教鞭）。
    *   **基础绘图**：画笔（自由绘制）、直线、箭头（指向说明）。
    *   **序号工具 (Counter)**：
        *   **自动递增**：每次点击自动生成递增的数字序号 (1, 2, 3...)。
        *   **独立交互**：序号圆圈 (Badge) 和说明文字 (Label) 支持**独立选中、拖拽和缩放**。
        *   **智能连线**：圆圈与文字之间自动绘制平滑连接线，避免重叠。
        *   **动态缩放**：文字大小时，序号圆圈按优化比例缩放（限制最大尺寸），避免喧宾夺主。
    *   **形状工具**：矩形框（支持圆角/直角切换、实心填充）、圆形/椭圆框（支持实心填充）。
    *   **属性面板**：
        *   **布局**：紧凑的 3 栏布局（大小/透明度 | 颜色选择 | 样式选项）。
        *   **颜色**：提供常用预设颜色（红/粉/蓝/黄/绿）及自定义颜色选择器。
        *   **样式**：
            *   **实心 (Fill)**：使用当前颜色和不透明度填充形状内部。
            *   **圆角 (Rounded)**：矩形工具支持圆角样式。
            *   **加粗 (Bold)**：文字工具支持加粗。
        *   **智能显示**：选中已有标注时自动显示对应的属性面板，支持再次编辑。
    *   **隐私保护**：马赛克/高斯模糊工具（用于遮挡敏感信息）。
    *   **文本工具**：添加文字注释。
    *   **撤销/重做**：支持编辑操作的回退。

### 3. 用户交互与浮层模块 (UI & Overlay)
*   **功能目标**：提供直观的用户操作入口和视觉反馈。
*   **关键特性**：
    *   **屏幕遮罩**：截图开始时屏幕变暗，高亮选区。
    *   **混合选择模式**：同时支持鼠标拖拽（坐标选择）和自动吸附窗口（窗口选择），二者无缝切换。
    *   **悬浮工具栏**：
        *   截图选定后自动跟随在选区右下角（智能避让屏幕边界）。
        *   包含 **Cancel**（取消截图）和 **Confirm**（确认截图）按钮。
        *   支持 ESC 撤销选区/退出，支持 Cmd+Q 强制退出。
    *   **放大镜**：选择区域时提供像素级放大的辅助视图，便于精确裁剪。
    *   **系统托盘/菜单栏常驻**：
        *   应用运行时在菜单栏右上角显示图标。
        *   提供快速退出 (Quit) 和设置入口，确保无 Dock 模式下的可控性。
    *   **防误触**：
        *   点击选区外部不会立即重置选区，必须通过拖拽（Drag）才能开始新选区。
        *   **选中取消**：当已有标注被选中时，点击空白处仅**取消选中**并隐藏属性面板，不会立即创建新标注，防止误操作。

### 4. 输出与分发模块 (Output & Export)
*   **功能目标**：处理截图后的保存与流转。
*   **关键特性**：
    *   **剪贴板**：默认或手动将图片复制到剪贴板。
    *   **文件保存**：保存为 PNG/JPG 等格式到本地磁盘。
    *   **拖拽交互**：支持直接将截图预览图拖拽到其他应用（如微信、飞书、邮件）。
    *   **OCR 识别**：(亮点功能) 利用 macOS 原生能力识别截图中的文字。

### 5. 设置与管理模块 (Settings & Management)
*   **功能目标**：提供个性化配置和后台管理。
*   **关键特性**：
    *   **快捷键**：支持自定义全局快捷键唤起截图。
    *   **通用设置**：默认保存路径、图片格式、开机自启等。
    *   **权限管理**：引导用户授予屏幕录制权限。
