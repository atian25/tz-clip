# RFC 004: 标注工具栏与绘制 (Toolbar & Annotation)

## 1. 背景与目标 (Background & Goals)
在用户确定截图选区后，需要提供一组工具以便用户对截图内容进行标记、修饰或执行后续操作（如复制、保存）。
本 RFC 旨在定义**标注工具栏**的视觉布局、交互逻辑以及支持的**标注工具集合**。

参考对标产品：Snipaste, PixPin 等成熟截图工具。

## 2. 总体设计 (Overview)

### 2.1 布局与层级
*   **显示时机**: 当选区状态进入 `selected` (已确认选区) 时显示。在 `moving` 或 `resizing` 过程中可暂时隐藏或降低不透明度，操作结束后恢复。
*   **位置策略**:
    *   **默认位置**: 紧贴选区**下边缘**，水平居中或左对齐（视选区宽度而定）。
    *   **避让策略**: 
        *   当选区底部距离屏幕底部空间不足（< 工具栏高度 + Padding）时，显示在选区**内侧底部**或**上边缘上方**。
*   **层级**: 位于 `OverlayWindow` 的最高层，遮挡选区内容。

### 2.2 视觉风格
*   **主工具栏**: 圆角矩形长条，背景纯白或磨砂玻璃效果，带有轻微阴影。
*   **图标**: 简洁的线性或填充图标。
*   **状态**:
    *   **Normal**: 默认状态。
    *   **Hover**: 鼠标悬停高亮。
    *   **Active**: 当前选中的工具（背景加深或高亮色）。

## 3. 功能定义 (Feature Definitions)

基于参考产品，我们将功能划分为 **MVP (最小可行性版本)** 和 **Future (后续迭代)**。

### 3.1 标注工具 (Annotation Tools)

| 图标 | 名称 | MVP | 说明 |
| :--- | :--- | :--- | :--- |
| ↖ | **选择 (Select)** | ✅ | 用于选中已有标注，进行移动、变形或删除。 |
| □ | **矩形 (Rectangle)** | ✅ | 绘制空心矩形框。Shift: 正方形。 |
| ○ | **椭圆 (Ellipse)** | ✅ | 绘制空心椭圆/圆。Shift: 正圆。 |
| ↗ | **箭头 (Arrow)** | ✅ | 绘制带箭头的线段。Shift: 45度吸附。 |
| ╱ | **直线 (Line)** | ✅ | 绘制直线。Shift: 45度吸附。 |
| ✎ | **画笔 (Pen)** | ✅ | 自由绘制曲线 (Freehand)。 |
| ▒ | **马赛克 (Mosaic)** | ⏳ | 模糊或像素化处理区域 (后续支持)。 |
| T | **文字 (Text)** | ✅ | 插入文本输入框。 |
| ① | **序号 (Counter)** | ⏳ | 点击自动递增的数字标签 (后续支持)。 |
| 🔦 | **高亮 (Highlight)** | ⏳ | 类似记号笔，半透明覆盖 (后续支持)。 |

### 3.2 属性设置 (Properties)

当选中某个绘图工具，或使用选择工具选中某个标注对象时，在主工具栏下方显示**次级属性面板**。

*   **MVP 属性**:
    *   **颜色**: 提供预设色板 (红, 黄, 绿, 蓝, 白, 黑, 紫, 橙)。
    *   **粗细**: 提供 3 档 (细, 中, 粗) 或滑动条。
    *   **文字大小**: (仅针对文字工具) 提供 3 档字号。
*   **交互**: 
    *   点击工具图标 -> 激活工具并弹出属性面板，设置**当前工具的默认属性**。
    *   选中已有标注 -> 弹出属性面板，回显并修改**该标注的属性**。

### 3.3 核心操作 (Actions)

| 图标 | 名称 | MVP | 说明 |
| :--- | :--- | :--- | :--- |
| 📌 | **贴图 (Pin)** | ⏳ | 将选区固定在屏幕上 (RFC 002)。 |
| ↩ | **撤销 (Undo)** | ✅ | 撤销上一步标注操作。 |
| 🔍 | **OCR** | ⏳ | 提取选区文字。 |
| ✕ | **关闭 (Close)** | ✅ | 退出截图，不保存。 |
| 📱 | **长截图** | ⏳ | 滚动截取长内容。 |
| ⬇ | **保存 (Save)** | ✅ | 保存到文件 (弹出保存对话框)。 |
| ✓ | **复制 (Copy)** | ✅ | 复制图像到剪贴板并退出 (默认行为: 双击选区也触发此操作)。 |

## 4. 交互细节 (Interaction Details)

### 4.1 绘制与编辑流程
1.  **绘制**: 选择工具 -> 拖拽绘制 -> 完成。
    *   绘制完成后，该图形自动处于“选中”状态（显示控制点）。
2.  **选择**: 
    *   切换到“选择工具” (或者在绘图工具下按住 Cmd 键暂切？MVP 建议明确的工具切换)。
    *   点击已有标注 -> 选中，显示 8 个控制点（Rect/Ellipse）或 2 个端点（Line/Arrow）。
    *   支持框选多个？(MVP 暂不支持，仅单选)。
3.  **变形 (Resize)**: 拖拽控制点改变大小/形状。
4.  **移动 (Move)**: 拖拽标注内部（非控制点区域）移动位置。
5.  **删除**: 选中状态下按 `Delete` 或 `Backspace` 键删除。

### 4.2 撤销/重做栈
*   维护一个 `AnnotationHistory` 栈。
*   每次完成绘制（MouseUp）或完成编辑（变形/移动/属性修改结束）推入一个 Action。
*   点击撤销移除栈顶 Action 并重绘。

### 4.3 快捷键支持
*   `Cmd + C`: 复制
*   `Cmd + S`: 保存
*   `Esc`: 退出截图 (如果在绘制中则取消当前绘制)
*   `Cmd + Z`: 撤销
*   `Delete` / `Backspace`: 删除选中标注
*   `Shift`: 规则化绘制 (正方形/圆/45度)

## 5. 待确认事项 (Open Questions)
*   [ ] **双击选区**的行为：是直接“复制并退出”还是“确认选区但不退出”？(建议：复制并退出，符合习惯)。
*   [ ] **右键菜单**：选区内右键是否需要菜单？(MVP 暂不包含)。
